<p>Bei Ihnen hat sich etwas geändert? Dann aktualisieren Sie hier einfach Ihre Daten. </p>

<mat-vertical-stepper [linear]="false" #stepper>
  <mat-step [stepControl]="nameFormGroup">
    <form [formGroup]="nameFormGroup">
      <ng-template matStepLabel>Starten wir ganz einfach</ng-template>
      <mat-form-field>
        <mat-label>Wie ist Ihr Name?</mat-label>
        <input matInput placeholder="Max Mustermann" formControlName="nameCtrl" required>
      </mat-form-field>
      <mat-form-field>
        <mat-label>Und wie heißt Ihr Laden?</mat-label>
        <input matInput placeholder="Maxis Modeladen" formControlName="businessNameCtrl" required>
      </mat-form-field>
      <div>
        <button mat-button matStepperNext>Weiter</button>
      </div>
    </form>
  </mat-step>
  <mat-step [stepControl]="addressFormGroup">
    <form [formGroup]="addressFormGroup">
      <ng-template matStepLabel>Wo befindet sich Ihr Laden?</ng-template>
      <mat-form-field>
        <mat-label>Straße</mat-label>
        <input matInput formControlName="streetCtrl" placeholder="Hauptstr. 11"
               required>
      </mat-form-field>
      <mat-form-field>
        <mat-label>PLZ</mat-label>
        <input matInput formControlName="zipCtrl" placeholder="12345" type="text"
               oninput="javascript: this.value=this.value.replace(new RegExp(/[^\d]/g), ''); if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
               maxlength="5" minlength="5"
               required>
      </mat-form-field>
      <mat-form-field>
        <mat-label>Stadt</mat-label>
        <mat-select formControlName="cityCtrl" style="width: 100%" required>
          <mat-option *ngFor="let city of citySuggestions" [value]="city.placeName">{{city.placeName}}</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field>
        <mat-label>Adresszusatz</mat-label>
        <input matInput formControlName="suffixCtrl" placeholder="Hinterhof">
      </mat-form-field>
      <div>
        <button mat-button matStepperPrevious>Zurück</button>
        <button mat-button matStepperNext>Weiter</button>
      </div>
    </form>
  </mat-step>
  <mat-step [stepControl]="descriptionFormGroup">
    <form [formGroup]="descriptionFormGroup">
      <ng-template matStepLabel>Beschreiben Sie Ihren Laden.</ng-template>
      <div style="width: 100%">
        <p>Was verkaufen Sie, was zeichnet Ihren Laden aus und wobei können Sie Ihre Kunden am besten beraten?</p>
        <mat-form-field style="width: 100%">
          <mat-label>Beschreibung</mat-label>
          <textarea matInput formControlName="descriptionCtrl"
                    placeholder="Hier gibt es vegane Kleidung und Schuhe. "
                    required></textarea>
        </mat-form-field>
      </div>
      <div>
        <p>Falls Sie eine Webseite haben, können Sie diese anzeigen lassen und Ihren Kunden dort weitere Details zu
          Ihrem Laden zur Verfügung stellen.</p>
        <mat-form-field>
          <mat-label>Webseite</mat-label>
          <input matInput formControlName="urlCtrl" placeholder="https://mywebsite.de">
        </mat-form-field>
      </div>
      <div>
        <button mat-button matStepperPrevious>Zurück</button>
        <button mat-button matStepperNext>Weiter</button>
      </div>
    </form>
  </mat-step>
  <mat-step [stepControl]="contactFormGroup">
    <form [formGroup]="contactFormGroup">
      <ng-template matStepLabel>Ihre Kontaktmöglichkeiten. </ng-template>
      <p>Füllen Sie einfach alle Möglichkeiten aus, die Sie bedienen wollen. </p>
      <small *ngIf="contactFormGroup.hasError('atLeastOneRequired')" style="color: red">{{contactFormGroup.getError('atLeastOneRequired').text}}
      </small>
      <div *ngFor="let contactType of contactTypes.availableContactTypes">
        <p>
          <mat-icon svgIcon="{{contactType}}"
                    style="margin-right: 5px; vertical-align: bottom"></mat-icon>
          {{contactTypes.getDisplayName(contactType)}}
        </p>
        <mat-form-field>
          <mat-label>Ihr Kontakt</mat-label>
          <input matInput formControlName="{{contactType.toLowerCase()}}Ctrl" placeholder="Ihre Kontaktmöglichkeit">
        </mat-form-field>
      </div>
      <div>
        <button mat-button matStepperPrevious>Zurück</button>
        <button mat-button matStepperNext>Weiter</button>
      </div>
    </form>
  </mat-step>
  <mat-step [stepControl]="openingFormGroup">
    <form [formGroup]="openingFormGroup">
      <ng-template matStepLabel>Was sind Ihre Öffnungszeiten?</ng-template>
      <div style="margin-top: 15px; margin-bottom: 30px; float:left;"
           *ngFor="let day of days">
        <button mat-mini-fab color="primary"
                [ngClass]="{'disabled' : !this.businessHours.POSSIBLE_BUSINESS_HOURS.get(day).enabled}"
                (click)="toggleAvailability(day)">{{day.substring(0, 2)}}
        </button>
      </div>
      <div *ngFor="let day of days" style="clear: both;">
        <h2 [ngClass]="{'disabled-font' : !this.businessHours.POSSIBLE_BUSINESS_HOURS.get(day).enabled}"
            style="float:left; margin-right: 50px; vertical-align: bottom; width: 15%;">{{day}}</h2>
        <mat-form-field>
          <mat-label>Von</mat-label>
          <input formControlName="{{day}}FromCtrl" matInput type="time"
                 value="{{this.businessHours.POSSIBLE_BUSINESS_HOURS.get(day).from}}">
        </mat-form-field>
        <mat-form-field>
          <mat-label>Bis</mat-label>
          <input formControlName="{{day}}ToCtrl" matInput type="time"
                 value="{{this.businessHours.POSSIBLE_BUSINESS_HOURS.get(day).to}}">
        </mat-form-field>
      </div>
      <div>
        Wie lange beraten Sie Ihre Kunden im Schnitt?
        <mat-form-field style="width: 30px; padding-left: 8px;">
          <input formControlName="defaultCtrl" matInput type="number">
        </mat-form-field>
        Minuten
      </div>
      <div>
        Wie viel Pause brauchen Sie dazwischen?
        <mat-form-field style="width: 30px; padding-left: 8px;">
          <input formControlName="pauseCtrl" matInput type="number">
        </mat-form-field>
        Minuten
      </div>
      <div>
        <button mat-button matStepperPrevious>Zurück</button>
      </div>
    </form>
  </mat-step>
  <mat-step [optional]="true">
    <ng-template matStepLabel>Sie haben ein Logo?</ng-template>
    <p>Bitte beachten Sie die maximale Dateigröße von 2 MB.</p>
    <input
      style="display: none"
      type="file" (change)="onFileChanged($event)"
      #fileInput>
    <div *ngIf="this.image.data">{{this.image.data.name}}</div>
    <button (click)="fileInput.click()">Datei auswählen...</button>
    <mat-error *ngIf="fileIsTooBig">Die Datei ist zu groß. Bitte wählen Sie eine Datei aus, die maximal 2 MB groß ist.</mat-error>
  </mat-step>
</mat-vertical-stepper>
<!-- TODO: Show progress bar on save -->
<mat-progress-bar *ngIf="this.image.progress > 0" [value]="this.image.progress"></mat-progress-bar>
